<skuidpage showsidebar="false" showheader="true" tabtooverride="Account">
   <models>
      <model id="AccountData" limit="1" query="true" createrowifnonefound="false" sobject="Account">
         <fields>
            <field id="Name"/>
            <field id="CreatedDate"/>
            <field id="Description"/>
            <field id="Fax"/>
            <field id="AccountNumber"/>
            <field id="Phone"/>
            <field id="BillingCity"/>
            <field id="BillingCountry"/>
            <field id="BillingState"/>
            <field id="BillingStreet"/>
            <field id="BillingPostalCode"/>
            <field id="CreatedById"/>
            <field id="CreatedBy.Name"/>
            <field id="NumberOfEmployees"/>
            <field id="Industry"/>
            <field id="LastActivityDate"/>
            <field id="LastModifiedById"/>
            <field id="LastModifiedBy.Name"/>
            <field id="LastModifiedDate"/>
            <field id="OwnerId"/>
            <field id="Owner.Name"/>
            <field id="ParentId"/>
            <field id="Parent.Name"/>
            <field id="ShippingCity"/>
            <field id="ShippingCountry"/>
            <field id="ShippingState"/>
            <field id="ShippingStreet"/>
            <field id="ShippingPostalCode"/>
            <field id="Website"/>
            <field id="Type"/>
            <field id="AnnualRevenue"/>
         </fields>
         <conditions>
            <condition type="param" enclosevalueinquotes="true" operator="=" field="Id" value="id"/>
         </conditions>
      </model>
      <model id="Contact" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Contact">
         <fields>
            <field id="LastName"/>
            <field id="FirstName"/>
            <field id="Title"/>
            <field id="Email"/>
            <field id="Phone"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="AccountId" operator="=" enclosevalueinquotes="true"/>
         </conditions>
      </model>
      <model id="Opportunities" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Opportunity">
         <fields>
            <field id="Amount"/>
            <field id="CloseDate"/>
            <field id="IsClosed"/>
            <field id="TotalOpportunityQuantity"/>
            <field id="StageName"/>
            <field id="Name"/>
            <field id="Close_Date_Time__c"/>
            <field id="Alliance_Partner__c"/>
            <field id="Alliance_Partner__r.Name"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="AccountId" operator="=" enclosevalueinquotes="true"/>
         </conditions>
      </model>
      <model id="Cases" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Case">
         <fields>
            <field id="Account.Name"/>
            <field id="Id"/>
            <field id="Type"/>
            <field id="Description"/>
            <field id="CreatedDate"/>
            <field id="ContactId"/>
            <field id="Contact.Name"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="AccountId" operator="=" enclosevalueinquotes="true"/>
         </conditions>
      </model>
      <model id="TaskHistory" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Task">
         <fields>
            <field id="Subject"/>
            <field id="WhoId"/>
            <field id="WhatId"/>
            <field id="Type"/>
            <field id="Type__c"/>
            <field id="ActivityDate"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="WhatId" operator="=" mergefield="Id" enclosevalueinquotes="true"/>
            <condition type="join" value="" field="WhatId" operator="in" enclosevalueinquotes="true" joinobject="Opportunity" joinfield="Id">
               <conditions>
                  <condition type="param" value="Id" field="AccountId" operator="=" enclosevalueinquotes="true"/>
               </conditions>
            </condition>
            <condition type="fieldvalue" value="Completed" enclosevalueinquotes="true" field="Status"/>
            <condition type="fieldvalue" value="true" enclosevalueinquotes="false" field="IsClosed"/>
         </conditions>
      </model>
      <model id="EmailtoSF" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="EmailServicesAddress">
         <fields>
            <field id="LocalPart"/>
            <field id="EmailDomainName"/>
         </fields>
         <conditions>
            <condition type="userinfo" value="" field="RunAsUserId" operator="=" enclosevalueinquotes="true" userinfotype="userid"/>
            <condition type="fieldvalue" value="true" enclosevalueinquotes="false" field="IsActive"/>
            <condition type="fieldvalue" value="EmailToSalesforce" enclosevalueinquotes="true" field="Function.FunctionName"/>
         </conditions>
      </model>
      <model id="OpenTasks" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Task">
         <fields>
            <field id="Subject"/>
            <field id="WhoId"/>
            <field id="WhatId"/>
            <field id="Priority"/>
            <field id="Status"/>
            <field id="ActivityDate"/>
            <field id="OwnerId"/>
            <field id="Owner.Name"/>
            <field id="AccountId"/>
            <field id="Account.Name"/>
            <field id="ReminderDateTime"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="WhatId" operator="=" mergefield="Id" enclosevalueinquotes="true"/>
            <condition type="fieldvalue" value="Completed" enclosevalueinquotes="true" field="Status" operator="!="/>
            <condition type="fieldvalue" value="true" enclosevalueinquotes="false" field="IsClosed" operator="!="/>
         </conditions>
      </model>
      <model id="AccountContactEvents" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Event">
         <fields>
            <field id="WhoId"/>
            <field id="Who.Name"/>
            <field id="WhatId"/>
            <field id="What.Name"/>
            <field id="Subject"/>
            <field id="StartDateTime"/>
            <field id="EndDateTime"/>
            <field id="Description"/>
            <field id="ActivityDateTime"/>
         </fields>
         <conditions logic="">
            <condition type="param" value="" field="WhatId" operator="=" mergefield="Id" enclosevalueinquotes="true"/>
         </conditions>
      </model>
      <model id="OpportunityEvents" limit="100" query="true" createrowifnonefound="false" orderby="LastModifiedDate DESC" sobject="Opportunity">
         <fields>
            <field id="AccountId"/>
            <field id="Account.Name"/>
            <field id="Close_Date_Time__c"/>
            <field id="Name"/>
         </fields>
         <conditions>
            <condition type="param" value="Id" field="AccountId" operator="=" enclosevalueinquotes="true"/>
         </conditions>
      </model>
   </models>
   <components>
      <pagetitle model="AccountData">
         <maintitle>
            <template>{{Name}}</template>
         </maintitle>
         <subtitle>
            <template>{{Model.Label}}</template>
         </subtitle>
         <actions>
            <action type="clone"/>
            <action type="share"/>
            <action type="delete"/>
            <action type="savecancel" label="New Action">
               <models>
                  <model>Contact</model>
                  <model>Opportunities</model>
                  <model>Cases</model>
                  <model>EmailtoSF</model>
                  <model>OpenTasks</model>
                  <model>TaskHistory</model>
                  <model>AccountContactEvents</model>
                  <model>AccountOpportunityEvents</model>
               </models>
            </action>
         </actions>
      </pagetitle>
      <tabset>
         <tabs>
            <tab name="Profile" icon="ui-silk-building">
               <components>
                  <basicfieldeditor showsavecancel="true" showheader="true" model="AccountData" mode="read">
                     <columns>
                        <column width="50%">
                           <sections>
                              <section title="Basics">
                                 <fields>
                                    <field id="Name"/>
                                    <field id="Website"/>
                                 </fields>
                              </section>
                              <section title="Phone">
                                 <fields>
                                    <field id="Phone"/>
                                    <field id="Fax"/>
                                 </fields>
                              </section>
                              <section title="Address Info">
                                 <fields>
                                    <field type="COMBO">
                                       <label>Billing Address</label>
                                       <template>{{BillingStreet}}
{{BillingCity}}{{#BillingState}}, {{/BillingState}} {{BillingState}} {{BillingPostalCode}}
{{BillingCountry}}</template>
                                    </field>
                                    <field type="COMBO">
                                       <label>Shipping Address</label>
                                       <template>{{ShippingStreet}}
{{ShippingCity}}{{#ShippingState}}, {{/ShippingState}} {{ShippingState}} {{ShippingPostalCode}}
{{ShippingCountry}}</template>
                                    </field>
                                 </fields>
                              </section>
                           </sections>
                        </column>
                        <column width="50%">
                           <sections>
                              <section title="Additional Info">
                                 <fields>
                                    <field id="Type">
                                       <label>Type</label>
                                    </field>
                                    <field id="Description">
                                       <label>Description</label>
                                    </field>
                                    <field id="Industry"/>
                                    <field id="NumberOfEmployees"/>
                                    <field id="AnnualRevenue"/>
                                 </fields>
                              </section>
                              <section title="System Info">
                                 <fields>
                                    <field id="ParentId">
                                       <label>Parent Account</label>
                                    </field>
                                    <field id="OwnerId">
                                       <label>Owner</label>
                                    </field>
                                    <field type="COMBO">
                                       <label>Last Modified By</label>
                                       <template>{{LastModifiedById}}, {{LastModifiedDate}}</template>
                                    </field>
                                    <field type="COMBO">
                                       <label>Created By</label>
                                       <template>{{CreatedById}}, {{CreatedDate}}</template>
                                    </field>
                                 </fields>
                              </section>
                           </sections>
                        </column>
                     </columns>
                  </basicfieldeditor>
               </components>
            </tab>
            <tab name="Contacts" icon="ui-silk-group">
               <components>
                  <skootable showconditions="true" showsavecancel="true" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="false" model="Contact" mode="read">
                     <fields>
                        <field id="FirstName"/>
                        <field id="LastName"/>
                        <field id="Title"/>
                        <field type="COMBO" allowhtml="true">
                           <label>Email</label>
                           <template>{{#Email}}{{Email}} [&lt;a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to={{{Email}}}&amp;bcc=emailtosalesforce@{{#$Model.EmailToSF.data}}{{EmailDomainName}}{{/$Model.EmailToSF.data}}&amp;shva=1" target="ComposeGmail"&gt;&lt;img src="/img/google/gmail_M_icon.gif" alt=""/&gt; Gmail&lt;/a&gt;]{{/Email}}</template>
                        </field>
                        <field id="Phone"/>
                     </fields>
                     <rowactions>
                        <action type="edit"/>
                        <action type="delete"/>
                        <action type="redirect" label="View Profile" url="/{{Id}}" icon="ui-silk-user-go"/>
                        <action type="redirect" label="Send Email" url="/_ui/core/email/author/EmailAuthor?p2_lkid={{Id}}&amp;rtype={{Model.KeyPrefix}}&amp;retURL=%2F{{Id}}" icon="ui-silk-email-go"/>
                     </rowactions>
                     <massactions usefirstitemasdefault="true">
                        <action type="massupdate"/>
                        <action type="massdelete"/>
                        <action type="redirect" label="Mass Email Selected Contacts would rock" icon="ui-silk-email-go" url="/{{d}}"/>
                     </massactions>
                     <views>
                        <view type="standard"/>
                     </views>
                     <actions defaultlabel="Global Actions" defaulticon="ui-silk-wand" usefirstitemasdefault="true">
                        <action type="redirect" label="New {{Model.Label}}" url="/{{Model.KeyPrefix}}/e?retURL=%2F{{Id}}&amp;accid={{Id}}" icon="ui-silk-user-add"/>
                        <action type="redirect" label="Merge Contacts" url="/merge/conmergewizard.jsp?retURL=%2F{{Id}}i&amp;id={{Id}}" icon="ui-silk-arrow-merge"/>
                     </actions>
                     <filters>
                        <filter type="select" filteroffoptionlabel="All {{Model.LabelPlural}}" createfilteroffoption="true">
                           <sources>
                              <source type="manual">
                                 <options>
                                    <option label="My Contacts" type="complex">
                                       <effects>
                                          <effect action="activate" value="" condition="Owner is Me"/>
                                       </effects>
                                    </option>
                                    <option label="Recently Modified" type="complex">
                                       <effects>
                                          <effect action="activate" value="" condition="LastModifiedDate"/>
                                       </effects>
                                    </option>
                                 </options>
                              </source>
                           </sources>
                        </filter>
                     </filters>
                  </skootable>
               </components>
               <components/>
            </tab>
            <tab name="Opportunities" icon="ui-silk-coins">
               <components>
                  <skootable showconditions="true" showsavecancel="true" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="true" model="Opportunities" mode="read">
                     <fields>
                        <field id="Name"/>
                        <field id="Amount"/>
                        <field id="StageName"/>
                        <field id="IsClosed"/>
                        <field id="CloseDate"/>
                     </fields>
                     <rowactions>
                        <action type="edit"/>
                     </rowactions>
                     <massactions usefirstitemasdefault="true">
                        <action type="massupdate"/>
                     </massactions>
                     <views>
                        <view type="standard"/>
                     </views>
                  </skootable>
               </components>
            </tab>
            <tab name="Activities" icon="ui-silk-telephone">
               <components>
                  <tabset>
                     <tabs>
                        <tab name="Tasks" icon="ui-silk-tick">
                           <components>
                              <template model="OpenTasks" multiple="true" allowhtml="true">&lt;div class="nx-editor-header-title"&gt;Open Tasks&lt;/div&gt;</template>
                              <skootable showconditions="true" showsavecancel="false" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="true" model="OpenTasks" mode="read">
                                 <fields>
                                    <field id="Subject"/>
                                    <field type="COMBO" allowhtml="true">
                                       <label>Related To</label>
                                       <template>{{WhoId}}, {{WhatId}}</template>
                                    </field>
                                    <field id="Priority"/>
                                    <field id="Status"/>
                                    <field id="ActivityDate"/>
                                    <field id="ReminderDateTime"/>
                                    <field id="OwnerId"/>
                                 </fields>
                                 <rowactions>
                                    <action type="edit"/>
                                    <action type="delete"/>
                                    <action type="custom" label="Mark Completed" icon="ui-silk-tick" snippet="tasks.markCompleted"/>
                                 </rowactions>
                                 <massactions usefirstitemasdefault="true">
                                    <action type="massupdate"/>
                                    <action type="massdelete"/>
                                    <action type="custom" label="Mark Completed" icon="ui-silk-tick" snippet="tasks.markCompleted"/>
                                 </massactions>
                                 <views>
                                    <view type="standard"/>
                                 </views>
                              </skootable>
                              <template model="TaskHistory" multiple="true" allowhtml="true">&lt;div class="nx-editor-header-title"&gt;Completed Tasks&lt;/div&gt;</template>
                              <skootable showconditions="true" showsavecancel="false" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="true" model="TaskHistory" mode="read">
                                 <fields>
                                    <field id="Subject"/>
                                    <field type="COMBO" allowhtml="true">
                                       <label>Related To</label>
                                       <template>{{WhoId}}, {{WhatId}}</template>
                                    </field>
                                    <field id="Type"/>
                                    <field id="Type__c"/>
                                    <field id="ActivityDate"/>
                                 </fields>
                                 <rowactions>
                                    <action type="edit"/>
                                    <action type="delete"/>
                                 </rowactions>
                                 <massactions usefirstitemasdefault="true">
                                    <action type="massupdate"/>
                                    <action type="massdelete"/>
                                 </massactions>
                                 <views>
                                    <view type="standard"/>
                                 </views>
                              </skootable>
                           </components>
                        </tab>
                        <tab name="Calendar" icon="ui-silk-calendar-view-day">
                           <components>
                              <skoocal>
                                 <sources>
                                    <eventsource name="Events" model="AccountContactEvents" startfield="StartDateTime" endfield="EndDateTime" groupfield="WhoId" namefield="Subject">{{Subject}}
{{Description}}
</eventsource>
                                    <eventsource name="Tasks" model="OpenTasks" color="lightgreen" namefield="Subject" startfield="ReminderDateTime" endfield="ReminderDateTime" groupfield="OwnerId">Reminder: {{Subject}}</eventsource>
                                    <eventsource name="Opportunities" model="OpportunityEvents" namefield="Name" startfield="Close_Date_Time__c" endfield="Close_Date_Time__c" color="orange">{{Name}} Opportunity Closes</eventsource>
                                 </sources>
                                 <views>
                                    <eventview type="month"/>
                                    <eventview type="week"/>
                                    <eventview type="month"/>
                                 </views>
                              </skoocal>
                           </components>
                        </tab>
                     </tabs>
                  </tabset>
               </components>
            </tab>
            <tab name="Cases" icon="ui-silk-bug">
               <components>
                  <skootable showconditions="true" showsavecancel="true" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="true" model="Cases" mode="read">
                     <fields>
                        <field id="ContactId">
                           <label>Contact</label>
                        </field>
                        <field id="Id">
                           <label>Case</label>
                        </field>
                        <field id="Type"/>
                        <field id="Description"/>
                        <field id="CreatedDate"/>
                     </fields>
                     <rowactions>
                        <action type="edit"/>
                        <action type="delete"/>
                     </rowactions>
                     <massactions usefirstitemasdefault="true">
                        <action type="massupdate"/>
                        <action type="massdelete"/>
                     </massactions>
                     <views>
                        <view type="standard"/>
                     </views>
                  </skootable>
               </components>
            </tab>
            <tab name="Feed / History" icon="ui-silk-comments">
               <components>
                  <social model="AccountData"/>
               </components>
            </tab>
      </tabset>
   </components>
   <resources>
      <labels/>
      <css/>
      <javascript>
         <jsitem location="inlinesnippet" name="markCompleted" url="">skuid.snippet.registerSnippet('tasks.markCompleted',function(params){
                // Mark all selected items as closed,
                // then save our 2 Tasks models
                var model = params.model,
                    list = params.list,
                    selectedItems = params.item ? [params.item] : list.getSelectedItems();
                if (selectedItems.length === 1 &amp;&amp; skuid.model.isNewId(selectedItems[0].row.Id)) {
                    alert('Please finish creating this Task before marking it as completed.');
                    return;
                }
                $j.each(selectedItems,function(i,item){
                    model.updateRow(item.row,'Status','Completed');
                });
                // Block the list from having updates
                list.element.block({
                    css: list.blockUICSS, overlayCSS: list.blockOverlayCSS,
                    message:'Marking Tasks as Completed...'
                });
            
                var saveFinishes = model.save({callback:
                    function(){
                        var updateFinishes = skuid.model.updateData([model,skuid.model.getModel('TaskHistory')]);
                        $j.when(updateFinishes).then(
                            function(){ list.element.unblock(); },
                            function(){ list.element.unblock(); }
                        );
                    }
                });
                
            });</jsitem>
      </javascript>
   </resources>
</skuidpage>
