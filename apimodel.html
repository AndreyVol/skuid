---
layout: main
title: skuid.model
---

skuid.model Object
=================
The skuid.model object provides a mechanism for communicating with the 
force.com database. Models are defined using the Skuid page builder and can be
accessed and manipulated using this API.
## Classes
### Model Class
#### Constructor
Use `skuid.model.getModel( modelId )` to retrieve an instance of a model where 
`modelId` is the id given to the model in the page builder.
#### Prototype Methods
##### `getFieldValue( row, field, noEscape )`
Returns the value for a particular field in a row from this model. Use model 
methods that return rows such as `getFirstRow()` to retrieve an instance of a row.
By default, Skuid will return the *escaped* value of the field, unless you set `noEscape` to true.
The benefit of using this method is that `field` can be specified as a string in relational syntax,
e.g. 'Account.Parent.Owner.Name', and Skuid will automatically traverse the object hierarchy in that row,
e.g. if your data row looks like this:
{ 
  Account: { 
     Parent: { 
        Owner: { 
           Name: "George Bailey", 
           Id: "005000000000123AAA"
        },
        OwnerId: "005000000000123AAA",
        Name : "The Parent Account",
        Id: "001000000000011AAA"
     },
     ParentId: "001000000000011AAA",
     Name: "Main Account"
  }
}     
then `model.getFieldValue(row,'Account.Parent.Owner.Name')` will return 'George Bailey'.
         
##### `getField( fieldName )`
Returns a Javascript object representing a field in this model where `fieldName` 
is the API name of the field requested. This object contains most of the Salesforce field metadata
provided in the Apex [`DescribeFieldResult`](http://www.salesforce.com/us/developer/docs/apexcode/Content/apex_methods_system_fields_describe.htm) object, 
as well as any child fields, if the field is a child relationship (e.g. 'Contacts', 'Sessions__r').
##### `getFirstRow()`
Returns the first row in this model.
##### `getRowById( id )`
Returns the row in this model identified by the given `id`.
##### `updateData( callback )`
Requests an update for this model from the server. An optional callback can
be sent in and it will be run after the update is complete.
##### `createRow( options )`
Creates a new row and attaches it to this model. The following options can be provided:
 - `doAppend`: if true, then this row will be added to the end of the model.
 - `additionalConditions`: a list of Condition objects that should be applied to the new row
    in addition to any active Conditions already on the model.
Returns the new row that was created.    
##### `updateRow( row, field, value )`
Updates the value of the data for the given row and field, 
then notifies all registered Ui elements that changes took place. 
Changes made will *not* be sent to the server until the `save()` method is called.
##### `updateRow( row, {field1: value1, ... [, fieldN: valueN ] } )`
Allows for making updates to multiple fields on a given row all at once,
instead of having to make the updates one by one.
##### `deleteRow( row )`
Marks the given row for deletion. This will not be sent to the server until
the `save()` method is called.
##### `undeleteRow( row )`
Unmarks the given row for deletion. This will not be sent to the server until
the `save()` method is called.
##### `cancel()`
Reverts all changes made to this model since it was last saved or updated. 
Rows flagged for deletion are immediately thrown out.
##### `save(options)`
Sends all changes to this model to the server, then executes an optional callback
function which can be provided through options.callback.
Returns a [jQuery Deferred](http://api.jquery.com/category/deferred-object/), 
which will be resolved upon completion of the save operation.
##### `updateData(callback)`
Refreshes just the data that should be in a model from the server, 
then executes an optional callback function.
Returns a [jQuery Deferred](http://api.jquery.com/category/deferred-object/), 
which will be resolved upon completion of the update operation.
##### `getConditionByName(conditionName, [searchSubConditions])`
Searches this Model for a Condition with the requested name, 
optionally searching sub conditions as well, and returns the Condition.
##### `setCondition(condition,value,[affectCookies])`
Sets the value of a Condition on the Model, where Condition is an object,
which should be retrieved using `getConditionByName`.
If affectCookies is explicitly set to true, and this Condition has a name,
then a corresponding session Cookie will be created or updated with this new value.
##### `activateCondition(condition,[affectCookies])`
Sets the 'inactive' property on a Condition to false, where Condition is an object,
which should be retrieved using `getConditionByName`.
If affectCookies is explicitly set to true, and this Condition has a name,
then a corresponding session Cookie will have its value set to '-on-'
##### `deactivateCondition(condition,[affectCookies])`
Sets the 'inactive' property on a Condition to true, where Condition is an object,
which should be retrieved using `getConditionByName`.
If affectCookies is explicitly set to true, and this Condition has a name,
then a corresponding session Cookie will have its value set to '-off-'

## Methods
##### `getModel( modelId )`
Returns an instance of the model corresponding to the given `id`.
##### `isNewId( id )`
Returns a boolean depending on whether the id requested is an existing Salesforce
id or a new temporary id.
##### `save( models, options )`
Sends all changes for the given array of Models to the server. Returns a [jQuery Deferred](http://api.jquery.com/category/deferred-object/), 
which will be resolved upon completion of the save operation, and any callback specified in `options.callback`. 
To specify a callback function, provide a `callback` property of the options object. 
The callback function will be handed a `result` object containing the following:
  - totalsuccess: a boolean that is true only if *all* requested operations succeeded, for all rows.
  - insertResults: a list of result objects for all rows that Skuid attempted to insert
  - updateResults: a list of result objects for all rows that Skuid attempted to update
  - deleteResults: a list of result objects for all rows that Skuid attempted to update  
##### `updateData( models, callback )`
Requests an update for the given Models from the server. An optional callback
can be sent in and it will be run after the updates are complete. Returns a [jQuery Deferred](http://api.jquery.com/category/deferred-object/).

#### Example 1: accessing Models and rows, creating/saving rows

{% highlight javascript %}
// Get an instance of one of the models from the page metadata,
// say, on the Contact object
var contactModel = skuid.model.getModel('ContactModel');

// Get the first row of the model,
// which is probably an existing row from the database
var firstContact = contactModel.getFirstRow();

// Create a new Contact in our Model, passing in some extra conditions
// so that our row starts out with.
// If there are existing Conditions, or default field values,
// those will be applied to the new row as well.
var georgeBailey = contactModel.createRow({
   additionalConditions: [
      { field: 'FirstName', value: 'George',
      { field: 'LastName', value: 'Bailey',
      { field: 'Birthdate', value: '1942-03-24'
   ]
});

// Get the first row from an Account model,
// using another model API method
var accountModel = skuid.model.map().AccountModel,
    account = account.getFirstRow();

// Change the Account of all rows in our Contact model
$.each(contactModel.data,function(i,row){
   contactModel.updateRow(row,{
       AccountId: account.Id,
       Account: account
   });
});

// Save all changes in our Contact model
contactModel.save({callback: function(result){
   if (result.totalsuccess) {
      // Get the 15-digit Id of our newly-saved George Bailey Contact,
      // which will have had its Id and other fields updated after save
      console.log(georgeBailey.Id15);
      // Show the entire George Bailey Contact record
      console.log(georgeBailey);
   } else {
      console.log(result.insertResults);
      console.log(result.updateResults);
      console.log(result.deleteResults);      
   }
}});

{% endhighlight %}


#### Example 2: changing Conditions, refreshing Model data 

{% highlight javascript %}
// Get an instance of one of the models from the page metadata,
// say, on the Contact object
var contactModel = skuid.model.getModel('ContactModel');

// Get the named Condition on our Contact Model called 'AccountId'.
var accountIdCondition = contactModel.getConditionByName('AccountId');

// Set the value of this Condition to the Id of the 4th Account in our Account model,
// and have this value stored in the user's Cookies
contactModel.setCondition(
   accountIdCondition,
   skuid.model.getModel('AccountModel').data[3].Id,
   true
);

// Reload the data in our Contact Model now that we've updated the Condition
var deferred = skuid.model.updateData([contactModel]);
$.when(deferred).then(function(){
    console.log(contactModel.getFirstRow().AccountId);
});


{% endhighlight %}